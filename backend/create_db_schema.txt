-- =========================================================
--  DATABASE SCHEMA FOR ANH THƠ SPA MANAGEMENT SYSTEM (MySQL)
--  VERSION: NORMALIZED & PRODUCTION-READY
-- =========================================================

-- It's recommended to run these commands manually in your SQL client.
-- DROP DATABASE IF EXISTS anhthospa_management;
-- CREATE DATABASE anhthospa_management;
-- USE anhthospa_management;

-- Drop tables in reverse order of creation to avoid foreign key constraints
DROP TABLE IF EXISTS payments;
DROP TABLE IF EXISTS sales;
DROP TABLE IF EXISTS internal_news;
DROP TABLE IF EXISTS internal_notifications;
DROP TABLE IF EXISTS staff_shifts;
DROP TABLE IF EXISTS staff_availability;
DROP TABLE IF EXISTS staff_tasks;
DROP TABLE IF EXISTS missions;
DROP TABLE IF EXISTS redeemed_rewards;
DROP TABLE IF EXISTS points_history;
DROP TABLE IF EXISTS redeemable_vouchers;
DROP TABLE IF EXISTS promotions;
DROP TABLE IF EXISTS reviews;
DROP TABLE IF EXISTS treatment_courses;
DROP TABLE IF EXISTS appointments;
DROP TABLE IF EXISTS services;
DROP TABLE IF EXISTS products;
DROP TABLE IF EXISTS service_categories;
DROP TABLE IF EXISTS wallets;
DROP TABLE IF EXISTS customers;
DROP TABLE IF EXISTS staff;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS staff_tiers;
DROP TABLE IF EXISTS tiers;


-- =========================================================
-- Base Tables (No Dependencies)
-- =========================================================
CREATE TABLE tiers (
    level INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    pointsRequired INT NOT NULL,
    minSpendingRequired FLOAT NOT NULL,
    color VARCHAR(7),
    textColor VARCHAR(255)
);

CREATE TABLE staff_tiers (
    id ENUM('Mới', 'Thành thạo', 'Chuyên gia') PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    minAppointments INT NOT NULL,
    minRating FLOAT NOT NULL,
    commissionBoost FLOAT,
    color VARCHAR(7),
    badgeImageUrl TEXT
);

CREATE TABLE service_categories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE products (
    id VARCHAR(255) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    price FLOAT NOT NULL,
    imageUrl TEXT,
    description TEXT,
    category VARCHAR(255),
    stock INT DEFAULT 0,
    INDEX idx_products_name (name),
    INDEX idx_products_category (category)
);

-- =========================================================
-- Core User & Profile Tables
-- =========================================================
CREATE TABLE users (
    id VARCHAR(255) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    phone VARCHAR(50),
    profilePictureUrl TEXT,
    joinDate DATE NOT NULL,
    birthday DATE,
    gender VARCHAR(50),
    role ENUM('Admin', 'Staff', 'Client') DEFAULT 'Client',
    status ENUM('Active', 'Inactive', 'Locked') DEFAULT 'Active',
    lastLogin DATETIME,
    loginHistory JSON,
    INDEX idx_users_email (email),
    INDEX idx_users_role (role)
);

CREATE TABLE customers (
    userId VARCHAR(255) PRIMARY KEY,
    tierLevel INT DEFAULT 1,
    selfCareIndex INT DEFAULT 50,
    address VARCHAR(255),
    totalSpending FLOAT DEFAULT 0,
    lastTierUpgradeDate DATETIME,
    qrCodeUrl TEXT,
    FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (tierLevel) REFERENCES tiers(level) ON DELETE SET NULL
);

CREATE TABLE staff (
    userId VARCHAR(255) PRIMARY KEY,
    staffRole ENUM('Manager', 'Technician', 'Receptionist') NOT NULL,
    specialty JSON,
    experience TEXT,
    staffTierId ENUM('Mới', 'Thành thạo', 'Chuyên gia'),
    commissionRate FLOAT DEFAULT 0,
    qrCodeUrl TEXT,
    kpiGoals JSON,
    FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (staffTierId) REFERENCES staff_tiers(id) ON DELETE SET NULL
);


CREATE TABLE wallets (
    userId VARCHAR(255) PRIMARY KEY,
    balance FLOAT DEFAULT 0,
    points INT DEFAULT 0,
    spinsLeft INT DEFAULT 3,
    FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE services (
    id VARCHAR(255) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    longDescription TEXT,
    price FLOAT NOT NULL,
    discountPrice FLOAT,
    duration INT NOT NULL,
    categoryId INT NOT NULL,
    imageUrl TEXT,
    rating FLOAT DEFAULT 0,
    reviewCount INT DEFAULT 0,
    isHot TINYINT(1) DEFAULT 0,
    isNew TINYINT(1) DEFAULT 0,
    promoExpiryDate DATE,
    isActive TINYINT(1) DEFAULT 1,
    FOREIGN KEY (categoryId) REFERENCES service_categories(id) ON DELETE RESTRICT,
    INDEX idx_services_name (name)
);

-- =========================================================
-- Transactional & History Tables
-- =========================================================
CREATE TABLE appointments (
    id VARCHAR(255) PRIMARY KEY,
    serviceId VARCHAR(255) NOT NULL,
    serviceName VARCHAR(255) NOT NULL,
    userId VARCHAR(255) NOT NULL,
    date DATE NOT NULL,
    time VARCHAR(20) NOT NULL,
    status ENUM('upcoming', 'completed', 'cancelled', 'pending', 'in-progress') DEFAULT 'pending',
    paymentStatus ENUM('Paid', 'Unpaid') DEFAULT 'Unpaid',
    therapist VARCHAR(255),
    therapistId VARCHAR(255),
    room VARCHAR(255),
    notesForTherapist TEXT,
    staffNotesAfterSession TEXT,
    isStarted TINYINT(1) DEFAULT 0,
    isCompleted TINYINT(1) DEFAULT 0,
    reviewRating INT,
    rejectionReason TEXT,
    bookingGroupId VARCHAR(255),
    FOREIGN KEY (serviceId) REFERENCES services(id) ON DELETE CASCADE,
    FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (therapistId) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_app_date_status (date, status),
    INDEX idx_app_booking_group (bookingGroupId)
);

CREATE TABLE reviews (
    id VARCHAR(255) PRIMARY KEY,
    userId VARCHAR(255) NOT NULL,
    serviceId VARCHAR(255) NOT NULL,
    serviceName VARCHAR(255),
    appointmentId VARCHAR(255) UNIQUE,
    userName VARCHAR(255) NOT NULL,
    userImageUrl TEXT,
    rating INT NOT NULL,
    comment TEXT,
    date DATETIME NOT NULL,
    managerReply TEXT,
    isHidden TINYINT(1) DEFAULT 0,
    FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (serviceId) REFERENCES services(id) ON DELETE CASCADE,
    FOREIGN KEY (appointmentId) REFERENCES appointments(id) ON DELETE SET NULL
);

CREATE TABLE promotions (
    id VARCHAR(255) PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    code VARCHAR(255) UNIQUE NOT NULL,
    expiryDate VARCHAR(255) NOT NULL,
    imageUrl TEXT,
    discountType ENUM('percentage', 'fixed') NOT NULL,
    discountValue FLOAT NOT NULL,
    termsAndConditions TEXT,
    targetAudience ENUM('All', 'New Clients', 'Birthday', 'Group', 'VIP',
        'Tier Level 1', 'Tier Level 2', 'Tier Level 3', 'Tier Level 4',
        'Tier Level 5', 'Tier Level 6', 'Tier Level 7', 'Tier Level 8') DEFAULT 'All',
    applicableServiceIds JSON,
    minOrderValue FLOAT DEFAULT 0,
    usageCount INT DEFAULT 0
);

CREATE TABLE redeemable_vouchers (
    id VARCHAR(255) PRIMARY KEY,
    description TEXT NOT NULL,
    pointsRequired INT NOT NULL,
    value FLOAT NOT NULL,
    applicableServiceIds JSON,
    targetAudience ENUM('All', 'VIP', 'Tier Level 1', 'Tier Level 2', 'Tier Level 3', 'Tier Level 4', 'Tier Level 5', 'Tier Level 6', 'Tier Level 7', 'Tier Level 8') DEFAULT 'All'
);

CREATE TABLE points_history (
    id VARCHAR(255) PRIMARY KEY,
    userId VARCHAR(255) NOT NULL,
    date DATETIME NOT NULL,
    description TEXT NOT NULL,
    pointsChange INT NOT NULL,
    FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_ph_user (userId)
);

CREATE TABLE redeemed_rewards (
    id VARCHAR(255) PRIMARY KEY,
    userId VARCHAR(255) NOT NULL,
    rewardDescription TEXT NOT NULL,
    pointsUsed INT NOT NULL,
    dateRedeemed DATETIME NOT NULL,
    FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_rr_user (userId)
);

CREATE TABLE missions (
    id VARCHAR(255) PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    points INT NOT NULL,
    isCompleted TINYINT(1) DEFAULT 0,
    userId VARCHAR(255) NOT NULL,
    type ENUM('service_count', 'service_variety', 'review_count', 'login'),
    required INT,
    serviceCategory VARCHAR(255),
    FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_missions_user (userId)
);

CREATE TABLE staff_availability (
    id VARCHAR(255) PRIMARY KEY,
    staffId VARCHAR(255) NOT NULL,
    date DATE NOT NULL,
    timeSlots JSON,
    FOREIGN KEY (staffId) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE (staffId, date)
);

CREATE TABLE staff_shifts (
    id VARCHAR(255) PRIMARY KEY,
    staffId VARCHAR(255) NOT NULL,
    date DATE NOT NULL,
    shiftType ENUM('morning', 'afternoon', 'evening', 'leave', 'custom') NOT NULL,
    status ENUM('approved', 'pending', 'rejected') DEFAULT 'pending',
    requestedBy VARCHAR(255),
    notes TEXT,
    assignedManagerId VARCHAR(255),
    shiftHours JSON,
    isUpForSwap TINYINT(1) DEFAULT 0,
    swapClaimedBy VARCHAR(255),
    managerApprovalStatus ENUM('pending_approval', 'approved', 'rejected'),
    room VARCHAR(255),
    FOREIGN KEY (staffId) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (assignedManagerId) REFERENCES users(id) ON DELETE SET NULL
);

CREATE TABLE staff_tasks (
    id VARCHAR(255) PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    assignedToId VARCHAR(255) NOT NULL,
    assignedById VARCHAR(255) NOT NULL,
    dueDate DATE NOT NULL,
    status ENUM('pending', 'in-progress', 'completed', 'overdue') NOT NULL,
    priority ENUM('low', 'medium', 'high') NOT NULL,
    createdAt DATETIME NOT NULL,
    completedAt DATETIME,
    FOREIGN KEY (assignedToId) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (assignedById) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_tasks_assigned_to (assignedToId),
    INDEX idx_tasks_due_date (dueDate)
);

CREATE TABLE sales (
    id VARCHAR(255) PRIMARY KEY,
    staffId VARCHAR(255),
    productId VARCHAR(255),
    productName VARCHAR(255) NOT NULL,
    quantity INT NOT NULL,
    totalAmount FLOAT NOT NULL,
    date DATETIME NOT NULL,
    status ENUM('completed', 'pending', 'returned') DEFAULT 'completed',
    clientId VARCHAR(255),
    paymentId VARCHAR(255),
    FOREIGN KEY (staffId) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (productId) REFERENCES products(id) ON DELETE SET NULL,
    FOREIGN KEY (clientId) REFERENCES users(id) ON DELETE SET NULL
);

CREATE TABLE internal_notifications (
    id VARCHAR(255) PRIMARY KEY,
    recipientId VARCHAR(255),
    recipientType ENUM('staff', 'client', 'all') NOT NULL,
    type ENUM('appointment_new', 'appointment_cancelled', 'shift_change', 'admin_message', 'promo_alert', 'system_news', 'client_feedback') NOT NULL,
    message TEXT NOT NULL,
    date DATETIME NOT NULL,
    isRead TINYINT(1) DEFAULT 0,
    link TEXT,
    relatedAppointmentId VARCHAR(255),
    FOREIGN KEY (relatedAppointmentId) REFERENCES appointments(id) ON DELETE SET NULL
);

CREATE TABLE internal_news (
    id VARCHAR(255) PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    authorId VARCHAR(255),
    date DATETIME NOT NULL,
    priority ENUM('low', 'medium', 'high') DEFAULT 'medium',
    FOREIGN KEY (authorId) REFERENCES users(id) ON DELETE SET NULL
);

CREATE TABLE treatment_courses (
    id VARCHAR(255) PRIMARY KEY,
    serviceId VARCHAR(255) NOT NULL,
    serviceName VARCHAR(255) NOT NULL,
    totalSessions INT NOT NULL,
    sessions JSON,
    clientId VARCHAR(255) NOT NULL,
    therapistId VARCHAR(255),
    status ENUM('active', 'completed', 'paused') DEFAULT 'active',
    FOREIGN KEY (serviceId) REFERENCES services(id) ON DELETE CASCADE,
    FOREIGN KEY (clientId) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (therapistId) REFERENCES users(id) ON DELETE SET NULL
);

CREATE TABLE payments (
    id VARCHAR(255) PRIMARY KEY,
    transactionId VARCHAR(255) UNIQUE NOT NULL,
    userId VARCHAR(255) NOT NULL,
    appointmentId VARCHAR(255),
    serviceName VARCHAR(255),
    amount FLOAT NOT NULL,
    method ENUM('Cash', 'Card', 'Momo', 'VNPay', 'ZaloPay') NOT NULL,
    status ENUM('Completed', 'Pending', 'Refunded') DEFAULT 'Pending',
    date DATETIME NOT NULL,
    therapistId VARCHAR(255),
    productId VARCHAR(255),
    FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (appointmentId) REFERENCES appointments(id) ON DELETE SET NULL,
    FOREIGN KEY (therapistId) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (productId) REFERENCES products(id) ON DELETE SET NULL,
    INDEX idx_pay_date (date)
);

-- =========================================================
-- SEEDING DATA (Example, actual seeding done in server.js)
-- =========================================================

-- Insert Tiers (Cấp độ thành viên)
INSERT INTO tiers (level, name, pointsRequired, minSpendingRequired, color, textColor) VALUES
(1, 'Đồng', 0, 0, '#CD7F32', 'text-amber-800'),
(2, 'Bạc', 1000, 1000000, '#C0C0C0', 'text-gray-500'),
(3, 'Vàng', 5000, 5000000, '#FFD700', 'text-yellow-500'),
(4, 'Bạch Kim', 15000, 15000000, '#E5E4E2', 'text-slate-400'),
(5, 'Kim Cương', 40000, 40000000, '#B9F2FF', 'text-sky-300'),
(6, 'SVIP', 80000, 80000000, '#f7b7f7', 'text-fuchsia-400'),
(7, 'Royal', 150000, 150000000, '#c7a17a', 'text-amber-600'),
(8, 'Infinity', 300000, 300000000, '#9370DB', 'text-purple-400');

-- Insert Staff Tiers (Cấp độ nhân viên)
INSERT INTO staff_tiers (id, name, minAppointments, minRating, commissionBoost, color, badgeImageUrl) VALUES
('Mới', 'Mới', 0, 0, 0, '#A8A29E', 'https://picsum.photos/seed/staff-tier-new/50/50'),
('Thành thạo', 'Thành thạo', 50, 4, 0.05, '#EF4444', 'https://picsum.photos/seed/staff-tier-proficient/50/50'),
('Chuyên gia', 'Chuyên gia', 150, 4.7, 0.1, '#10B981', 'https://picsum.photos/seed/staff-tier-expert/50/50');

-- Insert Service Categories (Danh mục dịch vụ)
INSERT INTO service_categories (id, name) VALUES
(1, 'Massage'), (2, 'Skincare'), (3, 'Body Care'), (4, 'Relax'),
(5, 'Spa Package'), (6, 'Triệt Lông'), (7, 'Clinic'), (8, 'Nail'), (9, 'Khác');

-- =========================================================
--  Dữ liệu người dùng, hồ sơ và ví
-- =========================================================
-- LƯU Ý: Mật khẩu là 'password123' đã được mã hóa. Server sẽ tự động mã hóa lại khi khởi động.
-- Mật khẩu hash cho 'password123': $2a$10$e.x2V.OMi1G0UB.2yP89bu4xQJ.Go.1V1UahvMKx7JqopIm7VBH.G

-- User: Trần Thị Hạnh (Admin)
INSERT INTO users (id, name, email, password, phone, profilePictureUrl, joinDate, birthday, gender, role, status, lastLogin) VALUES
('user-admin', 'Trần Thị Hạnh', 'admin@spa.vn', '$2a$10$e.x2V.OMi1G0UB.2yP89bu4xQJ.Go.1V1UahvMKx7JqopIm7VBH.G', '0901112233', 'https://picsum.photos/seed/U001/200', '2024-01-05', '1992-02-10', 'Nữ', 'Admin', 'Active', NOW());
INSERT INTO staff (userId, staffRole) VALUES
('user-admin', 'Manager');

-- User: Nguyễn Quang Minh (Staff/Manager)
INSERT INTO users (id, name, email, password, phone, profilePictureUrl, joinDate, birthday, gender, role, status, lastLogin) VALUES
('user-manager', 'Nguyễn Quang Minh', 'manager@spa.vn', '$2a$10$e.x2V.OMi1G0UB.2yP89bu4xQJ.Go.1V1UahvMKx7JqopIm7VBH.G', '0908889999', 'https://picsum.photos/seed/U002/200', '2024-01-20', '1990-03-14', 'Nam', 'Staff', 'Active', NOW());
INSERT INTO staff (userId, staffRole, commissionRate) VALUES
('user-manager', 'Manager', 0);

-- User: Lê Phương Anh (Staff/Technician)
INSERT INTO users (id, name, email, password, phone, profilePictureUrl, joinDate, birthday, gender, role, status, lastLogin) VALUES
('user-tech-1', 'Lê Phương Anh', 'tech1@spa.vn', '$2a$10$e.x2V.OMi1G0UB.2yP89bu4xQJ.Go.1V1UahvMKx7JqopIm7VBH.G', '0907778888', 'https://picsum.photos/seed/U003/200', '2024-02-01', '1995-06-20', 'Nữ', 'Staff', 'Active', NOW());
INSERT INTO staff (userId, staffRole, specialty, experience, staffTierId, commissionRate, kpiGoals) VALUES
('user-tech-1', 'Technician', '["Skincare", "Clinic", "Nail Care", "Facial"]', '5 năm', 'Chuyên gia', 0.1, '{"monthlyRevenue": 25000000, "monthlySessions": 50, "monthlySales": 5000000}');

-- User: Phạm Văn Tài (Staff/Technician)
INSERT INTO users (id, name, email, password, phone, profilePictureUrl, joinDate, birthday, gender, role, status, lastLogin) VALUES
('user-tech-2', 'Phạm Văn Tài', 'tech2@spa.vn', '$2a$10$e.x2V.OMi1G0UB.2yP89bu4xQJ.Go.1V1UahvMKx7JqopIm7VBH.G', '0903334444', 'https://picsum.photos/seed/U004/200', '2024-02-10', '1994-09-25', 'Nam', 'Staff', 'Active', NOW());
INSERT INTO staff (userId, staffRole, specialty, experience, staffTierId, commissionRate, kpiGoals) VALUES
('user-tech-2', 'Technician', '["Massage", "Body Care", "Relax"]', '3 năm', 'Thành thạo', 0.05, '{"monthlyRevenue": 20000000, "monthlySessions": 40, "monthlySales": 2000000}');

-- User: Trần Bích Ngọc (Staff/Receptionist)
INSERT INTO users (id, name, email, password, phone, profilePictureUrl, joinDate, birthday, gender, role, status, lastLogin) VALUES
('user-recep-1', 'Trần Bích Ngọc', 'recep1@spa.vn', '$2a$10$e.x2V.OMi1G0UB.2yP89bu4xQJ.Go.1V1UahvMKx7JqopIm7VBH.G', '0905556666', 'https://picsum.photos/seed/U005/200', '2024-03-02', '1998-12-12', 'Nữ', 'Staff', 'Active', NOW());
INSERT INTO staff (userId, staffRole, commissionRate) VALUES
('user-recep-1', 'Receptionist', 0);

-- User: Nguyễn Thu Hằng (Client)
INSERT INTO users (id, name, email, password, phone, profilePictureUrl, joinDate, birthday, gender, role, status, lastLogin) VALUES
('user-client-1', 'Nguyễn Thu Hằng', 'client1@spa.vn', '$2a$10$e.x2V.OMi1G0UB.2yP89bu4xQJ.Go.1V1UahvMKx7JqopIm7VBH.G', '0900001111', 'https://picsum.photos/seed/C001/200', '2024-03-15', '1996-07-21', 'Nữ', 'Client', 'Active', '2024-07-20 10:00:00');
INSERT INTO customers (userId, tierLevel, selfCareIndex, totalSpending) VALUES
('user-client-1', 1, 60, 900000);
INSERT INTO wallets (userId, balance, points, spinsLeft) VALUES
('user-client-1', 900000, 90, 3);

-- User: Lưu Hữu Nam (Client)
INSERT INTO users (id, name, email, password, phone, profilePictureUrl, joinDate, birthday, gender, role, status, lastLogin) VALUES
('user-client-2', 'Lưu Hữu Nam', 'client2@spa.vn', '$2a$10$e.x2V.OMi1G0UB.2yP89bu4xQJ.Go.1V1UahvMKx7JqopIm7VBH.G', '0901112222', 'https://picsum.photos/seed/C002/200', '2024-04-01', '1998-10-02', 'Nam', 'Client', 'Active', NOW());
INSERT INTO customers (userId, tierLevel, selfCareIndex, totalSpending) VALUES
('user-client-2', 2, 75, 2200000);
INSERT INTO wallets (userId, balance, points, spinsLeft) VALUES
('user-client-2', 2200000, 220, 3);

-- User: Phan Mai Chi (Client)
INSERT INTO users (id, name, email, password, phone, profilePictureUrl, joinDate, birthday, gender, role, status, lastLogin) VALUES
('user-client-3', 'Phan Mai Chi', 'client3@spa.vn', '$2a$10$e.x2V.OMi1G0UB.2yP89bu4xQJ.Go.1V1UahvMKx7JqopIm7VBH.G', '0902223333', 'https://picsum.photos/seed/C003/200', '2024-05-12', '2000-05-05', 'Nữ', 'Client', 'Active', NOW());
INSERT INTO customers (userId, tierLevel, selfCareIndex, totalSpending) VALUES
('user-client-3', 3, 85, 5500000);
INSERT INTO wallets (userId, balance, points, spinsLeft) VALUES
('user-client-3', 5500000, 550, 3);

-- =========================================================
--  Dữ liệu nghiệp vụ
-- =========================================================

-- Insert Services
INSERT INTO services (id, name, description, longDescription, price, discountPrice, duration, categoryId, imageUrl, rating, reviewCount, isHot, isNew, isActive) VALUES
('svc-facial-basic', 'Chăm sóc da mặt cơ bản', 'Làm sạch sâu, cấp ẩm cho da.', 'Liệu trình làm sạch sâu, loại bỏ bụi bẩn, tế bào chết và cung cấp độ ẩm cần thiết, mang lại làn da tươi sáng và mịn màng.', 500000, NULL, 60, 2, 'https://picsum.photos/seed/facial-basic/400/300', 4.8, 120, 1, 0, 1),
('svc-massage-body', 'Massage body thảo dược', 'Thư giãn toàn thân, giảm căng thẳng.', 'Sử dụng các loại thảo dược tự nhiên kết hợp kỹ thuật massage chuyên nghiệp giúp giảm căng cơ, lưu thông khí huyết và thư giãn tinh thần.', 700000, 600000, 90, 1, 'https://picsum.photos/seed/massage-body/400/300', 4.9, 250, 1, 1, 1),
('svc-hair-removal', 'Triệt lông nách Diode Laser', 'Triệt lông vĩnh viễn, an toàn.', 'Công nghệ Diode Laser hiện đại giúp loại bỏ lông tận gốc, an toàn cho da, không đau rát và mang lại hiệu quả lâu dài.', 800000, NULL, 30, 6, 'https://picsum.photos/seed/hair-removal/400/300', 4.7, 95, 0, 0, 1),
('svc-combo-relax', 'Gói Thư Giãn Toàn Diện', 'Combo massage body và chăm sóc da mặt chuyên sâu.', 'Trải nghiệm gói dịch vụ kết hợp hoàn hảo giữa 90 phút massage body thảo dược giúp xua tan mệt mỏi và 60 phút chăm sóc da mặt cơ bản, mang lại sự thư thái từ trong ra ngoài.', 1200000, 999000, 150, 5, 'https://picsum.photos/seed/combo-relax/400/300', 4.9, 75, 1, 0, 1),
('svc-combo-detox', 'Gói Thanh Lọc & Tái Tạo Da', 'Kết hợp xông hơi thải độc và liệu trình cấy tảo xoắn.', 'Gói dịch vụ thanh lọc cơ thể toàn diện với xông hơi thảo dược giúp đào thải độc tố, kết hợp cùng liệu trình cấy tảo xoắn trẻ hóa làn da, mang lại vẻ ngoài rạng rỡ và đầy sức sống.', 1500000, 1199000, 120, 5, 'https://picsum.photos/seed/combo-detox/400/300', 4.8, 45, 0, 1, 1),
('svc-combo-royal', 'Gói Chăm Sóc Toàn Thân Hoàng Gia', 'Trải nghiệm đẳng cấp hoàng gia với tẩy tế bào chết, ủ dưỡng thể và massage đá nóng.', 'Một liệu trình sang trọng bao gồm tẩy tế bào chết toàn thân bằng cafe, ủ dưỡng thể collagen vàng 24k và kết thúc bằng 90 phút massage thư giãn với đá nóng Himalaya, mang lại làn da mịn màng và tinh thần sảng khoái.', 2500000, 1999000, 180, 5, 'https://picsum.photos/seed/combo-royal/400/300', 5.0, 30, 1, 0, 1);

-- Insert Appointments
INSERT INTO appointments (id, serviceId, serviceName, userId, date, time, status, therapistId, therapist) VALUES
('apt-1', 'svc-facial-basic', 'Chăm sóc da mặt cơ bản', 'user-client-1', '2024-07-28', '10:00', 'completed', 'user-tech-1', 'Lê Phương Anh'),
('apt-2', 'svc-massage-body', 'Massage body thảo dược', 'user-client-2', '2024-08-05', '14:00', 'upcoming', 'user-tech-2', 'Phạm Văn Tài');

-- Insert Promotions
INSERT INTO promotions (id, title, description, code, expiryDate, imageUrl, discountType, discountValue, termsAndConditions, applicableServiceIds, usageCount) VALUES
('promo-1', 'Giảm 20% cho dịch vụ Facial', 'Ưu đãi đặc biệt cho tất cả các dịch vụ chăm sóc da mặt.', 'FACIAL20', '2024-12-31', 'https://picsum.photos/seed/promo-facial/500/300', 'percentage', 20, 'Áp dụng cho tất cả khách hàng.', '["svc-facial-basic"]', 50);

-- Insert Reviews
INSERT INTO reviews (id, serviceId, serviceName, userName, userImageUrl, rating, comment, date, appointmentId, userId) VALUES
('rev-1', 'svc-facial-basic', 'Chăm sóc da mặt cơ bản', 'Nguyễn Thu Hằng', 'https://picsum.photos/seed/C001/100', 5, 'Dịch vụ rất tốt, nhân viên nhiệt tình.', '2024-07-29 00:00:00', 'apt-1', 'user-client-1');

-- Insert Internal Notifications
INSERT INTO internal_notifications (id, recipientId, recipientType, type, message, date, isRead, link) VALUES
('in-1', 'user-client-1', 'client', 'promo_alert', 'Ưu đãi 20% cho tất cả dịch vụ Facial sắp hết hạn!', NOW(), 1, '/promotions'),
('in-2', 'all', 'client', 'system_news', 'Chào mừng bạn đến với phiên bản mới của app Anh Thơ Spa!', NOW(), 0, '/');

-- Insert Staff Tasks
INSERT INTO staff_tasks (id, title, description, assignedToId, assignedById, dueDate, status, priority, createdAt) VALUES
('task-1', 'Dọn dẹp kho', 'Sắp xếp lại các sản phẩm trong kho mỹ phẩm.', 'user-tech-1', 'user-manager', DATE_ADD(CURDATE(), INTERVAL 3 DAY), 'pending', 'medium', NOW()),
('task-2', 'Kiểm tra thiết bị laser', NULL, 'user-tech-2', 'user-manager', DATE_ADD(CURDATE(), INTERVAL 1 DAY), 'in-progress', 'high', NOW()),
('task-3', 'Hoàn thành báo cáo tuần', NULL, 'user-recep-1', 'user-manager', DATE_SUB(CURDATE(), INTERVAL 1 DAY), 'overdue', 'medium', DATE_SUB(NOW(), INTERVAL 5 DAY)),
('task-4', 'Lau dọn phòng VIP', NULL, 'user-tech-1', 'user-manager', CURDATE(), 'completed', 'low', DATE_SUB(NOW(), INTERVAL 2 DAY));
UPDATE staff_tasks SET completedAt = NOW() WHERE id = 'task-4';
